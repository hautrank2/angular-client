@if (isJsonForm) {
  <div class="mb-4">
    <p>
      <mat-slide-toggle [(ngModel)]="isJsonMode">JSON form</mat-slide-toggle>
    </p>
  </div>
}

@if (!asChild) {
  <form
    *ngIf="formGroup"
    (ngSubmit)="submit()"
    [formGroup]="formGroup"
    class="w-full pt-2"
  >
    <ng-container [ngTemplateOutlet]="contentTpl"></ng-container>
  </form>
} @else {
  <ng-container
    *ngIf="formGroup"
    [ngTemplateOutlet]="contentTpl"
  ></ng-container>
}

<ng-template #contentTpl>
  <!-- <div [ngClass]="[isJsonMode ? '' : 'invisible h-0 w-0']">
    <sh-json-form
      [value]="valuesStringtify"
      (onValueChange)="onJsonFormChange($event)"
    ></sh-json-form>
  </div> -->

  <div [ngClass]="[!isJsonMode ? '' : 'invisible h-0 w-0 overflow-hidden']">
    @if (formOptions.isGrid) {
      <div
        [ngClass]="[
          'form-fields',
          'grid',
          'grid-cols-' + (gridConfig?.cols ?? 1),
          'gap-' + (gridConfig?.gutter ?? 8),
        ]"
        class="w-full"
      >
        @for (field of fields; track $index) {
          <div
            [ngClass]="[
              'form-field',
              'col-span-' + (field?.col ?? 1),
              'form-field-' + field.name,
            ]"
          >
            <ng-container
              [ngTemplateOutlet]="fieldTpl"
              [ngTemplateOutletContext]="{ $implicit: field, field: field }"
            ></ng-container>
          </div>
        }
      </div>
    } @else {
      <div class="flex flex-col gap-2 w-full">
        @for (field of fields; track $index) {
          <div class="w-full">
            <ng-container
              [ngTemplateOutlet]="fieldTpl"
              [ngTemplateOutletContext]="{ $implicit: field, field: field }"
            ></ng-container>
          </div>
        }
      </div>
    }
  </div>

  <ng-template #fieldTpl let-field>
    <sh-form-field
      class="form-field-wrapper"
      [field]="field"
      [formGroup]="formGroup"
      [formOptions]="formOptions"
    ></sh-form-field>
  </ng-template>

  @if (!hideFooter && !asChild) {
    <div class="form-footer flex justify-between mt-4">
      <div>
        <button type="button" mat-stroked-button (click)="reset()">
          Reset
        </button>
      </div>
      <div>
        <button [disabled]="formGroup.invalid" mat-flat-button type="submit">
          Submit
        </button>
      </div>
    </div>
  }
</ng-template>
