<h2 mat-dialog-title>Edit poster and images</h2>

<mat-dialog-content class="p-0">
  <div class="flex flex-col gap-6">
    <!-- Poster -->
    <section class="flex flex-col gap-4">
      <div class="flex items-center gap-4 justify-between">
        <h3 appTypography="title-md" class="mb-2">Poster</h3>
        <button
          type="button"
          mat-flat-button
          [disabled]="uploadingPoster"
          (click)="onClickUploadPoster(posterInput)"
        >
          {{ uploadingPoster ? "Uploading…" : "Upload Poster" }}
        </button>
        <input
          #posterInput
          type="file"
          accept="image/*"
          hidden
          (change)="onPosterSelected($event)"
        />
      </div>

      @if (posterUrl) {
        <sh-image
          [src]="posterUrl"
          alt="Poster"
          width="100%"
          height="400px"
          class="rounded-lg"
        />
      } @else {
        <div
          class="w-full min-h-[220px] flex items-center justify-center border border-dashed border-gray-300 bg-gray-50 rounded-lg overflow-hidden"
        >
          <div class="text-gray-500 text-sm py-6">No poster</div>
        </div>
      }
    </section>

    <mat-divider></mat-divider>

    <!-- Images -->
    <section class="flex flex-col gap-4">
      <div class="flex items-center gap-4 justify-between">
        <h3 appTypography="title-md" class="mb-2">Images</h3>
        <button
          type="button"
          mat-flat-button
          [disabled]="uploadingImages"
          (click)="onClickUploadImages(imagesInput)"
        >
          {{ uploadingImages ? "Uploading…" : "Upload Images" }}
        </button>
        <input
          #imagesInput
          type="file"
          accept="image/*"
          hidden
          multiple
          (change)="onImagesSelected($event)"
        />
      </div>

      <div class="grid gap-4 grid-cols-2 sm:grid-cols-3 md:grid-cols-4">
        @for (url of imgUrls; track $index) {
          <div class="relative group border rounded-lg overflow-hidden">
            <sh-image
              [width]="'120px'"
              height="120px"
              [src]="url"
              alt="Image"
              [imgStyle]="{ objectFit: 'contain' }"
            />
            <button
              class="absolute top-2 right-2 w-7 h-7 flex items-center justify-center rounded-full bg-black/60 text-white text-lg opacity-0 group-hover:opacity-100 transition"
              (click)="onRemoveImage(url)"
              title="Remove"
            >
              ×
            </button>
          </div>
        }

        <div
          *ngIf="imgUrls.length === 0"
          class="col-span-full text-center text-gray-500 text-sm py-6 border border-dashed border-gray-300 rounded-lg bg-gray-50"
        >
          No images
        </div>
      </div>
    </section>
  </div>
</mat-dialog-content>

<mat-dialog-actions class="flex justify-end">
  <button
    mat-button
    mat-dialog-close
    cdkFocusInitial
    (click)="close()"
    class="!text-gray-700"
  >
    Close
  </button>
</mat-dialog-actions>
